! Device-Aware OSPF Configuration Template
! Automatically selects NX-OS or IOS OSPF configuration based on device name
! Device: {{ device_name }}

{% if 'SPINE' in device_name.upper() %}
! NX-OS OSPF Configuration (SPINE)
router ospf {{ ospf_process_id }}
  router-id {{ loopback0_ip }}
  area {{ ospf_area }} authentication message-digest
  log-adjacency-changes detail
  max-lsa 12000
  auto-cost reference-bandwidth 100000
  
  graceful-restart
  graceful-restart grace-period 60
  graceful-restart helper-disable
  
  area {{ ospf_area }} default-cost 1
  passive-interface default
  
  {% for interface in spine_interfaces %}
  interface {{ interface.name }}
    ip router ospf {{ ospf_process_id }} area {{ ospf_area }}
    ip ospf network point-to-point
    ip ospf hello-interval 1
    ip ospf dead-interval 3
    ip ospf message-digest-key 1 md5 {{ ospf_auth_key }}
    no passive-interface {{ interface.name }}
  {% endfor %}
  
  interface loopback0
    ip router ospf {{ ospf_process_id }} area {{ ospf_area }}
    
  interface loopback1
    ip router ospf {{ ospf_process_id }} area {{ ospf_area }}

{% elif 'LEAF' in device_name.upper() %}
! IOS OSPF Configuration (LEAF)
router ospf {{ ospf_process_id }}
  router-id {{ loopback0_ip }}
  log-adjacency-changes detail
  auto-cost reference-bandwidth 10000
  area {{ ospf_area }} authentication message-digest
  
  passive-interface default
  network {{ loopback0_ip }} 0.0.0.0 area {{ ospf_area }}
  
  {% for network in ospf_networks %}
  network {{ network.address }} {{ network.wildcard }} area {{ network.area }}
  {% endfor %}
  
  {% for interface in uplink_interfaces %}
  no passive-interface {{ interface.name }}
  {% endfor %}

! Interface-specific OSPF configuration
interface Loopback0
  ip ospf {{ ospf_process_id }} area {{ ospf_area }}

{% for interface in uplink_interfaces %}
interface {{ interface.name }}
  ip ospf {{ ospf_process_id }} area {{ ospf_area }}
  ip ospf network point-to-point
  ip ospf hello-interval 1
  ip ospf dead-interval 3
  ip ospf message-digest-key 1 md5 {{ ospf_auth_key }}
{% endfor %}

timers throttle spf 50 200 5000
timers throttle lsa all 50 200 5000

{% else %}
! Generic OSPF Configuration (Unknown device type)
router ospf {{ ospf_process_id }}
  router-id {{ loopback0_ip }}
  log-adjacency-changes detail
  area {{ ospf_area }} authentication message-digest
  
  network {{ loopback0_ip }} 0.0.0.0 area {{ ospf_area }}
  {% for network in ospf_networks %}
  network {{ network.address }} {{ network.wildcard }} area {{ network.area }}
  {% endfor %}
{% endif %}
