hostname SPINE1
!
spanning-tree mode pvst
spanning-tree extend system-id

configure terminal
hostname SPINE1

! Enable required features
feature ospf
feature bgp
feature bfd
feature interface-vlan
feature hsrp
feature scp-server
feature sftp-server

! Loopback
interface loopback0
 description Router-ID and BGP peer
 ip address 10.0.0.1/32
 ip ospf area 0.0.0.0
 no shutdown

! Trunk and routed links

interface ethernet1/1
 description P2P-Link-to-LEAF1

 no switchport
 ip address 10.100.100.1/30
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
 bfd interval 300 min_rx 300 multiplier 3

 no shutdown

interface ethernet1/2
 description P2P-Link-to-LEAF3

 no switchport
 ip address 10.100.100.5/30
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
 bfd interval 300 min_rx 300 multiplier 3

 no shutdown

interface ethernet1/3
 description P2P-Link-to-LEAF4

 no switchport
 ip address 10.100.100.9/30
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
 bfd interval 300 min_rx 300 multiplier 3

 no shutdown

interface ethernet1/4
 description P2P-Link-to-LEAF2

 no switchport
 ip address 10.100.100.13/30
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
 bfd interval 300 min_rx 300 multiplier 3

 no shutdown

interface ethernet1/5
 description Management-to-Cloud

 no switchport
 ip address 192.168.100.1/24
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
 bfd interval 300 min_rx 300 multiplier 3

 no shutdown

interface loopback0


 no switchport
 ip address 1.1.1.1/32
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
 bfd interval 300 min_rx 300 multiplier 3

 no shutdown


! VLANs

vlan 100
 name Web-Servers

vlan 200
 name App-Servers

vlan 300
 name DB-Servers


! SVIs and HSRP

interface vlan100
 description Web-Servers-Gateway
 ip address 192.168.100.2/24
 hsrp version 2
 hsrp 100
  ip 192.168.100.1
  priority 110
  preempt
  timers 1 3

 no shutdown

interface vlan200
 description App-Servers-Gateway
 ip address 192.168.200.2/24
 hsrp version 2
 hsrp 200
  ip 192.168.200.1
  priority 110
  preempt
  timers 1 3

 no shutdown

interface vlan300
 description DB-Servers-Gateway
 ip address 192.168.30.2/24
 hsrp version 2
 hsrp 300
  ip 192.168.30.1
  priority 110
  preempt
  timers 1 3

 no shutdown


! OSPF
router ospf 1
 router-id 1.1.1.1
 area 0.0.0.0 authentication message-digest
 bfd
 log-adjacency-changes detail
 timers throttle spf 50 200 5000

 passive-interface vlan100

 passive-interface vlan200

 passive-interface vlan300



! BGP
router bgp 65000
 router-id 1.1.1.1
 bestpath as-path multipath-relax
 address-family ipv4 unicast
  redistribute connected route-map 
  redistribute ospf 1 route-map 
  maximum-paths 

  neighbor 11.11.11.11
    remote-as 65000
    description LEAF1
    update-source loopback0
    address-family ipv4 unicast
      next-hop-self
      bfd

  neighbor 12.12.12.12
    remote-as 65000
    description LEAF2
    update-source loopback0
    address-family ipv4 unicast
      next-hop-self
      bfd

  neighbor 13.13.13.13
    remote-as 65000
    description LEAF3
    update-source loopback0
    address-family ipv4 unicast
      next-hop-self
      bfd

  neighbor 14.14.14.14
    remote-as 65000
    description LEAF4
    update-source loopback0
    address-family ipv4 unicast
      next-hop-self
      bfd

  neighbor 2.2.2.2
    remote-as 65000
    description SPINE2
    update-source loopback0
    address-family ipv4 unicast
      next-hop-self
      bfd


! Route-maps

route-map SERVER-NETWORKS permit 10
  match interface vlan100 vlan200 vlan300

route-map LOOPBACKS permit 10
  match interface loopback0


! SSH and user config

username admin password cisco123 role network-admin
ssh key rsa 2048
ssh server enable


! Static routes

ip route 0.0.0.0/0 192.168.100.1


exit
copy running-config startup-config